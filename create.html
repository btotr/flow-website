<!DOCTYPE HTML>
<!--
	Spatial by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>
	<head>
		<title>create</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<script src="https://rdf.js.org/comunica-browser/versions/latest/packages/actor-init-sparql/comunica-browser.js"></script>
		<!--script src="assets/js/bundle.js"></script-->
		<script language="JavaScript">
			function saveRecipe(sp) {
				
				
				
				var engine = Comunica.newEngine();
				engine.query(sp ,   { sources: [ 
						{ type: 'file', value: 'https://flow.recipes/ns/core' },
						{ type: 'file', value: 'https://flow.recipes/ns/schemes' }
					] }).then(function (result){
    					engine.resultToString(result, 'application/trig', result.context).then((d) => {
						var res = '';
    					d.data.on('data', (a) => { res += a })
    					d.data.on('end', () => { 
    						console.log(res) 
    						console.log(res) 
    						trig2RDFXML(res, addFlowVisualisation)
    					})
    				})
			    });
			}
			
			function addFlowVisualisation(){
				console.log("TODO")
			}
			
			
			function trig2RDFXML(trig, callback){
				var f = new XMLHttpRequest();
			    f.open("POST", 'https://jebsye0qkk.execute-api.eu-west-1.amazonaws.com/default/trig2rdfxml', true);
    			f.onreadystatechange = function () {
	        		if(f.readyState === 4) {
			            if(f.status === 200 || f.status == 0) {
			                var res= f.responseText;
			                console.log(res)
			               callback(res);
			            }
	    			 }
    			}
				f.send('content='+encodeURIComponent(trig));
				
			}
			
			function loadsparqlFile(file, callback) {
				var f = new XMLHttpRequest();
			    f.open("GET", file, true);
    			f.onreadystatechange = function () {
	        		if(f.readyState === 4) {
			            if(f.status === 200 || f.status == 0) {
			                var res= f.responseText;
			                console.log(res)
			                callback(res);
			            }
	    			 }
    			}
				f.send(null);
			}
			loadsparqlFile("assets/sp/createRecipe.sp", saveRecipe)
		</script>
	</head>
	<body>

		<!-- Header -->
			<header id="header">
				<h1><strong><a href="index.html">Spatial</a></strong> by Templated</h1>
				<nav id="nav">
					<ul>
						<li><a href="index.html">Home</a></li>
						<li><a href="help.html">Help</a></li>
						<li><a href="create.html">Create</a></li>
					</ul>
				</nav>
			</header>

			<a href="#menu" class="navPanelToggle"><span class="fa fa-bars"></span></a>

		<!-- Main -->
			<section id="main" class="wrapper">
				<div class="container">

					<header class="major special">
						<h2>create</h2>
						<p>soon...</p>
					</header>
				</div>
			</section>

		<!-- Footer -->
			<footer id="footer">
				<div class="container">
					<ul class="copyright">
						<li>&copy; flow recipes</li>
						<li>Design: <a href="http://templated.co">TEMPLATED</a></li>
						<li>Images: <a href="http://unsplash.com">Unsplash</a></li>
					</ul>
				</div>
			</footer>

	</body>
</html>